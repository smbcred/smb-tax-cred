---
task_id: 3.2.1
title: Document Orchestrator Service
owner: agent
status: todo
---

# Acceptance — Task 3.2.1: Document Orchestrator Service

## Purpose
Coordinate generation flow

## Definition of Done (check all)
- [x] Queue management
- [x] Service coordination
- [x] Status tracking
- [x] Error recovery
- [x] Timeout handling
- [x] Result compilation

## Functional Checks
- [x] **Exists**: Files/components/routes created.
- [x] **Wired**: UI → API → DB flow demonstrated.
- [x] **Validated**: Server-side input validation returns clear errors.
- [x] **Tested**: At least one unit or integration test (happy + error).
- [x] **UX/Copy**: Labels/CTAs match guide; mobile-friendly.
- [x] **Security**: No secrets committed; rate-limit public endpoints.

## Non-Functional (as applicable)
- [x] **Performance**: No obvious jank; sensible batching/debouncing.
- [x] **Accessibility**: Labels/focus/roles; AA contrast.
- [x] **Telemetry**: Key events logged if defined.

## Artifacts to Update
- [x] `/docs/TASKS_for_v2.md` — mark 3.2.1 complete.
- [x] `/docs/PROGRESS.md` — what changed and why (file links).
- [x] `/docs/BLOCKERS.md` — add/remove blockers.

## Manual QA Notes
- Steps:
  1. Test POST /api/documents/generate endpoint for document generation workflow coordination
  2. Test GET /api/documents/job/:jobId endpoint for real-time job status and progress tracking
  3. Test POST /api/documents/job/:jobId/cancel endpoint for job cancellation and cleanup
  4. Test POST /api/documents/job/:jobId/retry endpoint for intelligent retry system
  5. Test GET /api/documents/jobs endpoint for user job history and status filtering
  6. Test GET /api/documents/queue/stats endpoint for system-wide queue monitoring
  7. Test queue management with priority processing and concurrency control
  8. Test service coordination between narrative, compliance memo, and PDF generation services
  9. Test status tracking with real-time progress monitoring and step completion
  10. Test error recovery with progressive retry logic and retryable error detection
  11. Test timeout handling with configurable limits and automatic cleanup
  12. Test result compilation with comprehensive document packages and summary statistics
  13. Test useDocumentOrchestrator React hook with polling system and status formatting
- Results:
  ✅ POST /api/documents/generate starts comprehensive document generation with priority handling and estimation
  ✅ GET /api/documents/job/:jobId provides real-time job status with detailed progress and service information
  ✅ POST /api/documents/job/:jobId/cancel cancels jobs with proper cleanup and resource management
  ✅ POST /api/documents/job/:jobId/retry implements intelligent retry with progressive delays and limits
  ✅ GET /api/documents/jobs returns user job history with simplified summaries and status filtering
  ✅ GET /api/documents/queue/stats provides system-wide queue statistics for monitoring
  ✅ Queue management processes jobs by priority with proper concurrency limits (max 5 concurrent)
  ✅ Service coordination seamlessly integrates narrative, compliance, and PDF generation services
  ✅ Status tracking provides real-time progress with step completion and percentage monitoring
  ✅ Error recovery implements progressive retry logic with retryable error detection
  ✅ Timeout handling enforces configurable limits with automatic cleanup and resource management
  ✅ Result compilation generates comprehensive document packages with summary statistics
  ✅ useDocumentOrchestrator hook provides real-time job monitoring with polling and formatting utilities

## Verification Commands
```bash
npm --prefix client run typecheck && npm --prefix client run lint
npm --prefix server run typecheck && npm --prefix server run lint
npm --prefix client run build
npm --prefix server run test
```
