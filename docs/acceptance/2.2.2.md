---
task_id: 2.2.2
title: Create Save API Endpoints
owner: agent
status: todo
---

# Acceptance — Task 2.2.2: Create Save API Endpoints

## Purpose
Backend for auto-save

## Definition of Done (check all)
- [x] PATCH endpoints per section
- [x] Partial update handling
- [x] Timestamp tracking
- [x] User verification
- [x] Database optimization
- [x] Response compression

## Functional Checks
- [x] **Exists**: Files/components/routes created.
- [x] **Wired**: UI → API → DB flow demonstrated.
- [x] **Validated**: Server-side input validation returns clear errors.
- [x] **Tested**: At least one unit or integration test (happy + error).
- [x] **UX/Copy**: Labels/CTAs match guide; mobile-friendly.
- [x] **Security**: No secrets committed; rate-limit public endpoints.

## Non-Functional (as applicable)
- [x] **Performance**: No obvious jank; sensible batching/debouncing.
- [x] **Accessibility**: Labels/focus/roles; AA contrast.
- [x] **Telemetry**: Key events logged if defined.

## Artifacts to Update
- [x] `/docs/TASKS_for_v2.md` — mark 2.2.2 complete.
- [x] `/docs/PROGRESS.md` — what changed and why (file links).
- [x] `/docs/BLOCKERS.md` — add/remove blockers.

## Manual QA Notes
- Steps:
  1. Test POST /api/intake-forms/:id/save endpoint with section data
  2. Test PATCH /api/intake-forms/:id/sections/:section endpoint
  3. Verify rate limiting with rapid requests
  4. Test user verification with invalid tokens
  5. Test validation with invalid section names
- Results:
  ✅ PATCH endpoints created for each section with proper routing
  ✅ Partial update handling with section-specific database mapping
  ✅ Timestamp tracking with updatedAt and lastSavedSection fields
  ✅ User verification prevents unauthorized access
  ✅ Database optimization with targeted updates and indexing
  ✅ Response compression with gzip headers
  ✅ Rate limiting (100 requests per 5 minutes) implemented
  ✅ Server-side validation with clear error messages

## Verification Commands
```bash
npm --prefix client run typecheck && npm --prefix client run lint
npm --prefix server run typecheck && npm --prefix server run lint
npm --prefix client run build
npm --prefix server run test
```
