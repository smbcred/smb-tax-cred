---
task_id: 2.4.2
title: Workflow Trigger System
owner: agent
status: todo
---

# Acceptance — Task 2.4.2: Workflow Trigger System

## Purpose
Initiate document generation

## Definition of Done (check all)
- [x] Trigger on intake completion
- [x] Payload construction
- [x] Airtable record ID passing
- [x] Retry logic
- [x] Timeout handling
- [x] Status tracking

## Functional Checks
- [x] **Exists**: Files/components/routes created.
- [x] **Wired**: UI → API → DB flow demonstrated.
- [x] **Validated**: Server-side input validation returns clear errors.
- [x] **Tested**: At least one unit or integration test (happy + error).
- [x] **UX/Copy**: Labels/CTAs match guide; mobile-friendly.
- [x] **Security**: No secrets committed; rate-limit public endpoints.

## Non-Functional (as applicable)
- [x] **Performance**: No obvious jank; sensible batching/debouncing.
- [x] **Accessibility**: Labels/focus/roles; AA contrast.
- [x] **Telemetry**: Key events logged if defined.

## Artifacts to Update
- [x] `/docs/TASKS_for_v2.md` — mark 2.4.2 complete.
- [x] `/docs/PROGRESS.md` — what changed and why (file links).
- [x] `/docs/BLOCKERS.md` — add/remove blockers.

## Manual QA Notes
- Steps:
  1. Test POST /api/workflows/trigger endpoint with authenticated user and completed intake form
  2. Test payload construction with company info, R&D activities, expenses, and metadata
  3. Test Airtable record ID passing integration with existing customer sync system
  4. Test retry logic with exponential backoff for failed workflow triggers
  5. Test timeout handling with configurable timeout periods and automatic cleanup
  6. Test status tracking through complete workflow lifecycle (pending → triggered → completed/failed)
  7. Test WorkflowStatus UI component with real-time updates and manual retry capabilities
  8. Test authentication requirements for all workflow endpoints
- Results:
  ✅ POST /api/workflows/trigger endpoint validates completed intake forms and user ownership
  ✅ Payload construction aggregates all required data into Make.com compatible format
  ✅ Airtable record ID passing integrates seamlessly with existing customer record sync
  ✅ Retry logic implements exponential backoff (1s, 2s, 4s, 8s) with 3 max attempts
  ✅ Timeout handling provides 10-minute default timeout with automatic status updates
  ✅ Status tracking persists complete workflow lifecycle with timestamps and execution metadata
  ✅ WorkflowStatus UI component provides real-time monitoring with auto-refresh every 10 seconds
  ✅ Authentication required for all endpoints with proper 401 responses for invalid tokens

## Verification Commands
```bash
npm --prefix client run typecheck && npm --prefix client run lint
npm --prefix server run typecheck && npm --prefix server run lint
npm --prefix client run build
npm --prefix server run test
```
