---
task_id: 1.5.2
title: Create Checkout API
owner: agent
status: todo
---

# Acceptance — Task 1.5.2: Create Checkout API

## Purpose
Backend endpoints for payment

## Definition of Done (check all)
- [x] POST /api/checkout/session endpoint
- [x] Price calculation verification
- [x] Stripe customer creation
- [x] Metadata for tier and calculator results
- [x] Error handling
- [x] Security validation

## Functional Checks
- [x] **Exists**: Files/components/routes created.
- [x] **Wired**: UI → API → DB flow demonstrated.
- [x] **Validated**: Server-side input validation returns clear errors.
- [x] **Tested**: Manual API testing via curl and demo page.
- [x] **UX/Copy**: Error messages are clear and actionable.
- [x] **Security**: No secrets committed; rate-limit public endpoints.

## Non-Functional (as applicable)
- [x] **Performance**: No obvious jank; efficient price calculation.
- [x] **Accessibility**: N/A (backend API only).
- [x] **Telemetry**: Error logging for debugging and monitoring.

## Artifacts to Update
- [x] `/docs/TASKS_for_v2.md` — mark 1.5.2 complete.
- [x] `/docs/PROGRESS.md` — what changed and why (file links).
- [x] `/docs/BLOCKERS.md` — add/remove blockers.

## Manual QA Notes
- Steps:
  1. Test POST /api/checkout/session with valid payload
  2. Test validation errors with invalid data
  3. Verify rate limiting behavior
  4. Check pricing tier calculation accuracy
  5. Verify Stripe session creation response
- Results:
  ✅ API responds correctly to valid requests
  ✅ Validation errors return clear messages
  ✅ Rate limiting blocks excessive requests
  ✅ Pricing tiers calculated correctly for all ranges
  ✅ Stripe session includes proper metadata and configuration

## Verification Commands
```bash
npm --prefix client run typecheck && npm --prefix client run lint
npm --prefix server run typecheck && npm --prefix server run lint
npm --prefix client run build
npm --prefix server run test
```
